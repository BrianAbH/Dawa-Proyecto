<div class="container-fluid mt-4" style="max-width: 1400px;">
  <div class="row mb-4">
    <div class="col-12">
      <button class="btn btn-success btn-lg" (click)="openModal()">
        <i class="bi bi-plus-circle"></i> Agregar Nuevo Servicio
      </button>
    </div>
  </div>

  <div class="row">
    <div class="col-12">
      <div class="row">
        <div 
          class="col-12 col-md-6 col-lg-4 mb-4" 
          *ngFor="let servicio of servicios"
        >
          <div class="h-100 d-flex flex-column">
            <app-cards
              [titulo]="servicio.nombre"
              [categoria]="getCategoriaNombre(+servicio.categoria)"
              [descripcion]="getProfesionalNombre(+servicio.profesional_id)"
              [profesional]="servicio.profesional_id"
              [precio]="servicio.precio"
              [activo]="servicio.activo ? 'Activo' : 'Inactivo'"
              class="flex-grow-1"
              (onEdit)="edit(servicio)"
              (onDelete)="delete(servicio)"
            ></app-cards>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div #servicioModal class="modal fade" tabindex="-1" aria-labelledby="servicioModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="servicioModalLabel">
          {{ isEditing ? 'Editar Servicio' : 'Crear Servicio' }}
        </h5>
        <button type="button" class="btn-close btn-close-white" (click)="closeModal()" aria-label="Close"></button>
      </div>
      
      <div class="modal-body">
        <form [formGroup]="servicioForm" (ngSubmit)="onSubmit()">
          
          <div class="mb-3">
            <label for="nombre" class="form-label">Nombre del Servicio</label>
            <input 
              type="text" 
              class="form-control" 
              id="nombre"
              formControlName="nombre"
              [ngClass]="{'is-invalid': f['nombre'].invalid && (f['nombre'].dirty || f['nombre'].touched)}"
            >
            <div class="invalid-feedback" *ngIf="f['nombre'].invalid">
              <span *ngIf="f['nombre'].errors?.['required']">El nombre es requerido</span>
              <span *ngIf="f['nombre'].errors?.['minlength']">Mínimo 3 caracteres</span>
            </div>
          </div>

          <div class="mb-3">
            <label for="descripcion" class="form-label">Descripción</label>
            <textarea 
              class="form-control" 
              id="descripcion" 
              rows="3"
              formControlName="descripcion"
              [ngClass]="{'is-invalid': f['descripcion'].invalid && (f['descripcion'].dirty || f['descripcion'].touched)}"
            ></textarea>
            <div class="invalid-feedback" *ngIf="f['descripcion'].invalid">
              <span *ngIf="f['descripcion'].errors?.['required']">La descripción es requerida</span>
              <span *ngIf="f['descripcion'].errors?.['minlength']">Mínimo 10 caracteres</span>
            </div>
          </div>

          <!-- SELECT DE CATEGORÍAS -->
          <div class="mb-3">
            <label for="categoria" class="form-label">Categoría</label>
            <select 
              class="form-select" 
              id="categoria"
              formControlName="categoria"
              [ngClass]="{'is-invalid': f['categoria'].invalid && (f['categoria'].dirty || f['categoria'].touched)}"
            >
              <option value="">-- Seleccione una categoría --</option>
              <option *ngFor="let cat of categorias" [value]="cat.id">
                {{ cat.nombre }}
              </option>
            </select>
            <div class="invalid-feedback" *ngIf="f['categoria'].errors?.['required']">
              La categoría es requerida
            </div>
          </div>

          <div class="mb-3">
            <label for="precio" class="form-label">Precio ($)</label>
            <input 
              type="number" 
              class="form-control" 
              id="precio"
              formControlName="precio"
              min="0"
              step="0.01"
              [ngClass]="{'is-invalid': f['precio'].invalid && (f['precio'].dirty || f['precio'].touched)}"
            >
            <div class="invalid-feedback" *ngIf="f['precio'].invalid">
              <span *ngIf="f['precio'].errors?.['required']">El precio es requerido</span>
              <span *ngIf="f['precio'].errors?.['min']">El precio debe ser mayor o igual a 0</span>
            </div>
          </div>

          <div class="mb-3">
            <label for="duracionEstimada" class="form-label">Duración Estimada</label>
            <input 
              type="text" 
              class="form-control" 
              id="duracionEstimada"
              formControlName="duracionEstimada"
              placeholder="Ej: 1 hora, 30 minutos"
              [ngClass]="{'is-invalid': f['duracionEstimada'].invalid && (f['duracionEstimada'].dirty || f['duracionEstimada'].touched)}"
            >
            <div class="invalid-feedback" *ngIf="f['duracionEstimada'].errors?.['required']">
              La duración estimada es requerida
            </div>
          </div>

          <!-- SELECT DE PROFESIONALES -->
          <div class="mb-3">
            <label for="profesional_id" class="form-label">Profesional</label>
            <select 
              class="form-select" 
              id="profesional_id"
              formControlName="profesional_id"
              [ngClass]="{'is-invalid': f['profesional_id'].invalid && (f['profesional_id'].dirty || f['profesional_id'].touched)}"
            >
              <option value="">-- Seleccione un profesional --</option>
              <option *ngFor="let prof of profesionales" [value]="prof.id">
                {{ prof.nombreCompleto }}
              </option>
            </select>
            <div class="invalid-feedback" *ngIf="f['profesional_id'].errors?.['required']">
              El profesional es requerido
            </div>
          </div>

          <div class="mb-3 form-check">
            <input 
              type="checkbox" 
              class="form-check-input" 
              id="activo"
              formControlName="activo"
            >
            <label class="form-check-label" for="activo">Servicio Activo</label>
          </div>
        </form>
      </div>
      
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancelar</button>
        <button 
          type="button" 
          class="btn btn-primary"
          [disabled]="servicioForm.invalid"
          (click)="onSubmit()"
        >
          {{ isEditing ? 'Actualizar' : 'Crear' }}
        </button>
      </div>
    </div>
  </div>
</div>